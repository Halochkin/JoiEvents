<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test of clef chain working</title>
</head>
<body>
<h1>Reload (F5) to stop the sound</h1>
<a href="javascript:playOne();">one</a> <br>
<a href="javascript:scaleUp();">scaleUp</a> <br>
<a href="javascript:scaleDown();">scaleDown</a> <br>
<a href="javascript:turn5up();">turn5up()</a> <br>
<a href="javascript:turn5down();">turn5down()</a> <br>
<a href="javascript:swap();">swap()</a> <br>

<script>

  const ctx = new AudioContext();
  ctx.suspend();
  const osc = ctx.createOscillator();
  osc.type = "sine";

//  https://media-codings.com/articles/polyfilling-the-constant-source-node
  const andAone = ctx.createConstantSource();
  const lfo1 = ctx.createGain();
  lfo1.gain.value = 110;
  const lfo2 = ctx.createGain();
  lfo2.gain.value = 1;
  andAone.connect(lfo1);
  lfo1.connect(lfo2);
  lfo2.connect(osc.frequency);
  osc.connect(ctx.destination);
  andAone.start();
  osc.start();

  function playOne() {
    ctx.resume();
  }

  function scaleUp() {
    lfo2.gain.value *= 2;
  }
  function scaleDown() {
    lfo2.gain.value /= 2;
  }
  function turn5up() {
    lfo2.gain.value *= Math.pow(2, 1.5);
  }
  function turn5down() {
    lfo2.gain.value *= Math.pow(2, -1.5);
  }

  //The below function tests the disturbance from disconnecting and connecting new nodes.
  //For keys, with constant source, this is fairly unproblematic.
  //but, this would not be pretty if we replaced a sine with a square. We might have a drop in connection.
  const lfo2b = ctx.createGain();
  lfo2b.gain.value = 3;
  lfo1.connect(lfo2b);

  function swap() {
    lfo2.disconnect();
    lfo2b.connect(osc.frequency);
  }

</script>

</body>
</html>