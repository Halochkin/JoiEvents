<h1>here the beautiful sounds! (sic.)</h1>
<style>
  sound-strip {
    display: block;
  }
</style>

<sound-strip sound="square(500Hz)" sound-two="square(500Hz)"></sound-strip>
<sound-strip sound="noise > bandpass(500Hz)"></sound-strip>
<sound-strip sound="noise"></sound-strip>
<sound-strip sound="sine(340hz) > gain(square(2hz))"></sound-strip>
<sound-strip sound="sine(340hz) > gain([0.9/0.9, 0.6/0.001, 0.6/0.4, 0/0.02])"></sound-strip>
<sound-strip sound="sine(340hz) > gain(0.2)"></sound-strip>
<sound-strip sound="square(random([160hz, 1340hz, 4000hz, 340hz])) > gain(0.1)"></sound-strip>
<sound-strip sound="sine(random(1340hz)) > gain(0.1)"></sound-strip>
<sound-strip sound="sine(random(1600hz, 3040hz)) > gain(0.1)"></sound-strip>
<sound-strip sound="sine(random(0, 6000hz, 1000hz)) > gain(0.1)"></sound-strip>
<sound-strip sound="url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/355309/G4.mp3)"></sound-strip>
<sound-strip sound="url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/355309/G4.mp3, 1)" dont-stop></sound-strip>
<sound-strip sound="sine(F4)"></sound-strip>
<sound-strip sound="sine(Ab4)"></sound-strip>
<sound-strip sound="sine(C#4)"></sound-strip>
<sound-strip sound="sine(random([C4, E4, G4]))"></sound-strip>
<sound-strip sound="sine(circle5(F4,1))"></sound-strip>
<sound-strip sound="sawtooth(random([C2, E2, G2])) > gain([1/0.0015, 0/1.2]) > lowpass(244.5hz) > gain([1.0/0.001, 0/0.8])"></sound-strip>
<sound-strip sound="sawtooth(160hz, [[0,0.4,0.4,1,1,1,0.3,0.7,0.6,0.5,0.9,0.8]])"></sound-strip>


<script type="module">
  import {InfiniteSound} from "./InfiniteSounds/Interpreter.js";

  class SoundStrip extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({mode: "open"});
      this.shadowRoot.innerHTML = `
<input type="text" value="start sound">
<input type="text" value="">
<button id="start">long-press to play</button>
<button id="stop">stop second sound</button>
`;
      this.shadowRoot.children[2].addEventListener("mousedown", this.start.bind(this));
      this.shadowRoot.children[2].addEventListener("mouseup", this.startTwo.bind(this));
      this.shadowRoot.children[3].addEventListener("mousedown", this.stop.bind(this));
    }

    static get observedAttributes(){
      return ["sound", "sound-two"];
    }

    attributeChangedCallback(name, oldValue, newValue) {
      if (name === "sound")
        this.shadowRoot.children[0].value = newValue;
      if (name === "sound-two")
        this.shadowRoot.children[1].value = newValue;
    }

    async start() {
      this.stop();
      const x = this.shadowRoot.children[0].value;
      this.ctx = await InfiniteSound.load(x);
      this.ctx.resume();
      if (!this.hasAttribute("dont-stop"))
        this.timer = setTimeout(() => this.stop(), 1000);
    }

    async startTwo() {
      const x = this.shadowRoot.children[1].value;
      if (x === "")
        return this.stop();
      const nextCtx = await InfiniteSound.load(x);

      nextCtx.replace(this.ctx);
      this.stop();
      this.ctx = nextCtx;
      if (!this.hasAttribute("dont-stop"))
        this.timer = setTimeout(() => this.stop(), 1000);
    }

    stop() {
      this.ctx && this.ctx.stop();
      clearTimeout(this.timer);
    }
  }
  customElements.define("sound-strip", SoundStrip);

  //    const buffer = await interpret2(g);
  //    const audioCtx = new AudioContext();
  //    const bufferSource = audioCtx.createBufferSource();
  //    bufferSource.buffer = buffer;
  //    bufferSource.connect(audioCtx.destination);
  //    setTimeout(function(){
  //      audioCtx.suspend();
  //    }, 4000);
</script>

