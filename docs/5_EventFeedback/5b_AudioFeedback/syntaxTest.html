<script type="module">
  import {parse} from "./cssAudioParser.js";

  let a = "a > b > c";
  let a_ = '{"type":"pipe","nodes":["a","b","c"]}';
  let b = "a > --audio-var > c";
  let b_ = '{"type":"pipe","nodes":["a","--audio-var","c"]}';
  let c = "a > b > [c, d]";
  let c_ = '{"type":"pipe","nodes":["a","b",["c","d"]]}';
  let d = "square(144hz) > lowpass(180hz, 12dB)";
  let d_ = '{"type":"pipe","nodes":[{"type":"fun","name":"square","args":["144hz"]},{"type":"fun","name":"lowpass","args":["180hz","12dB"]}]}';
  let e = "square(144hz) > vol([1/0.0015],[0.6/0.001],[0.6/1],[0/0.03]) > lowpass(180hz, 12dB)";
  let e_ = '{"type":"pipe","nodes":[{"type":"fun","name":"square","args":["144hz"]},{"type":"fun","name":"vol","args":[[["1","0.0015"]],[["0.6","0.001"]],[["0.6","1"]],[["0","0.03"]]]},{"type":"fun","name":"lowpass","args":["180hz","12dB"]}]}';


  function test(msg, tst) {
    let obj = parse(msg);
    let stringify = JSON.stringify(obj);
    if (tst === stringify)
      console.log("success: ", msg, obj);
    else
      console.alert("error: ", msg, obj);
  }

  function resolve(node) {
    if (node.type === "pipe"){

    }
  }

  test(a, a_);
  test(b, b_);
  test(c, c_);
  test(d, d_);
  test(e, e_);

</script>